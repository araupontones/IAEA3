foa_nlo1_effectiveness = foa) %>%
select(-name)
}) %>% do.call(rbind,.)
#clean relevance ---------------------------------------------------------------
periods <- sort(unique(append_themes$period))
tabyl(clean_effectiveness, theme)
#14,725
clean_effectiveness <- append_themes %>%
mutate(period = factor(period,
labels = periods,
ordered = T)) %>%
mutate(foa_nlo1_effectiveness = str_trim(foa_nlo1_effectiveness),
foa_nlo1_effectiveness = str_replace_all(foa_nlo1_effectiveness, "  ", " "),
theme = from_nlo_to_foas(theme)) %>%
#get the improvements
left_join(mapping_foas,
by = c("foa_nlo1_effectiveness", "theme")
) %>%
#get the outcomes
left_join(lkp_outcomes) %>%
select(-int_outcome_nlo) %>%
#identifit those countries that have achieved it
mutate(achieved = ifelse(is.na(period)|period == "N/A", 0,1),
period = fct_recode(period, "< 2000" = "> 2000"))
tabyl(clean_effectiveness, theme)
unique(clean_effectiveness$foa_nlo1_effectiveness[clean_effectiveness$theme == "HEALTH and NUTRITION"])
unique(clean_effectiveness$foa_nlo1_effectiveness[clean_effectiveness$theme == "Health and Nutrition"])
unique(clean_effectiveness$foa[clean_effectiveness$theme == "Health and Nutrition"])
tabyl(clean_effectiveness, foa)
unique(clean_effectiveness$foa_nlo1_effectiveness[clean_effectiveness$theme == "Health and Nutrition"])
tabyl(clean_effectiveness, foa_nlo1_effectiveness)
my_theme = filter(clean_effectiveness, theme == "Health and Nutrition")
tabyl(my_theme, foa_nlo1_effectiveness)
tabyl(my_theme, foa)
sections
#export ------------------------------------------------------------------------
export(clean_effectiveness, glue('data/7.NLO/2.raw_formatted/Part_1_{sections[1]}.rds'))
#this data is cleaned in R/8.nlo/PartI/0.format
effectiveness <- import('data/7.NLO/2.raw_formatted/Part_1_effectiveness.rds')
tabyl(effectiveness, foa, theme)
library(rio)
library(dplyr)
library(tidyr)
library(janitor)
library(stringr)
library(forcats)
gmdacr::load_functions('functions/')
#import raw data creted in 0.format/format_names_part_1.R
#the above script formats the data from SPSS to R so it is readable
names(raw_data)
raw_data <- import('data/7.NLO/1.raw/Part_1.rds')
#names(mapping_foas)
#Mapping of foas
mapping_foas <- import('data/1.reference/mapping_foas.xlsx') %>%
#updating the name of the foa
select(theme,
foa,
foa_nlo1_effectiveness,
improvement) %>%
filter(!is.na(foa)) %>%
group_by(theme,foa) %>%
slice(1) %>%
ungroup()
#mapping_foas$foa[mapping_foas$theme == 'Health and Nutrition']
#lookup outcomes (to be consistent with ToC)
lkp_outcomes <- import('data/9.lookups/int_outcomes.xlsx')
#define section
sections <- c(#"relevance")
"effectiveness")
# "sustainability")
#"regionalCoop",
#"future",
#"visibility")
#define themes ---------------------------------------------------------------
themes <- names(raw_data)[str_detect(names(raw_data), 'theme')]
#each team enabled a different section of the questionnaire.
#bring all themes in a tidy format
#the name of the variable (created in 0.format/format_names_part_1.R) contains all the information
append_themes <- lapply(themes, function(t){
#get the suffix, it allows to identify the theme of the variables
sufix = get_suffix(t, raw_data)
r <- raw_data %>%
#keep data for relevance section only,
#and pivot it longer
#function created in functions.
keep_section(t, sections[1], sufix) %>%
#   #the column name contains all the info:
mutate(section = str_extract(name, '^.*?(?=-|_)'),
foa = str_remove(name, '^.*_[a-z]{1,}_'),
int_outcome_nlo = str_extract(foa, "_.{1,}$"),
foa = str_remove(foa, int_outcome_nlo),
int_outcome_nlo = str_remove(int_outcome_nlo, "_"),
int_outcome_nlo = str_trim(int_outcome_nlo),
int_outcome_nlo = ifelse(str_detect(int_outcome_nlo, "Upgrade institutions"), "Upgraded institutions / Laboratories/ Educational centers", int_outcome_nlo)
) %>%
rename(period = value,
foa_nlo1_effectiveness = foa) %>%
select(-name)
}) %>% do.call(rbind,.)
#clean relevance ---------------------------------------------------------------
periods <- sort(unique(append_themes$period))
tabyl(clean_effectiveness, theme)
#14,725
clean_effectiveness <- append_themes %>%
mutate(period = factor(period,
labels = periods,
ordered = T)) %>%
mutate(foa_nlo1_effectiveness = str_trim(foa_nlo1_effectiveness),
foa_nlo1_effectiveness = str_replace_all(foa_nlo1_effectiveness, "  ", " "),
theme = from_nlo_to_foas(theme)) %>%
#get the improvements
left_join(mapping_foas,
by = c("foa_nlo1_effectiveness", "theme")
) %>%
#get the outcomes
left_join(lkp_outcomes) %>%
select(-int_outcome_nlo) %>%
#identifit those countries that have achieved it
mutate(achieved = ifelse(is.na(period)|period == "N/A", 0,1),
period = fct_recode(period, "< 2000" = "> 2000"))
#my_theme = filter(clean_effectiveness, theme == "Health and Nutrition")
tabyl(my_theme, foa)
sections
#export ------------------------------------------------------------------------
export(clean_effectiveness, glue('data/7.NLO/2.raw_formatted/Part_1_{sections[1]}.rds'))
#export(clean_effectiveness, glue('data/11.powerbi/{sections}.csv'))
#names(mapping_foas)
#Mapping of foas
mapping_foas <- import('data/1.reference/mapping_foas.xlsx') %>%
#updating the name of the foa
select(theme,
foa,
foa_nlo1_effectiveness,
improvement) %>%
filter(!is.na(foa)) %>%
group_by(theme,foa) %>%
slice(1) %>%
ungroup()
raw_data <- import('data/7.NLO/1.raw/Part_1.rds')
#names(mapping_foas)
#Mapping of foas
mapping_foas <- import('data/1.reference/mapping_foas.xlsx') %>%
#updating the name of the foa
select(theme,
foa,
foa_nlo1_effectiveness,
improvement) %>%
filter(!is.na(foa)) %>%
group_by(theme,foa) %>%
slice(1) %>%
ungroup()
lkp_outcomes <- import('data/9.lookups/int_outcomes.xlsx')
#define section
sections <- c(#"relevance")
"effectiveness")
#define themes ---------------------------------------------------------------
themes <- names(raw_data)[str_detect(names(raw_data), 'theme')]
append_themes <- lapply(themes, function(t){
#get the suffix, it allows to identify the theme of the variables
sufix = get_suffix(t, raw_data)
r <- raw_data %>%
#keep data for relevance section only,
#and pivot it longer
#function created in functions.
keep_section(t, sections[1], sufix) %>%
#   #the column name contains all the info:
mutate(section = str_extract(name, '^.*?(?=-|_)'),
foa = str_remove(name, '^.*_[a-z]{1,}_'),
int_outcome_nlo = str_extract(foa, "_.{1,}$"),
foa = str_remove(foa, int_outcome_nlo),
int_outcome_nlo = str_remove(int_outcome_nlo, "_"),
int_outcome_nlo = str_trim(int_outcome_nlo),
int_outcome_nlo = ifelse(str_detect(int_outcome_nlo, "Upgrade institutions"), "Upgraded institutions / Laboratories/ Educational centers", int_outcome_nlo)
) %>%
rename(period = value,
foa_nlo1_effectiveness = foa) %>%
select(-name)
}) %>% do.call(rbind,.)
#clean relevance ---------------------------------------------------------------
periods <- sort(unique(append_themes$period))
tabyl(clean_effectiveness, theme)
#14,725
clean_effectiveness <- append_themes %>%
mutate(period = factor(period,
labels = periods,
ordered = T)) %>%
mutate(foa_nlo1_effectiveness = str_trim(foa_nlo1_effectiveness),
foa_nlo1_effectiveness = str_replace_all(foa_nlo1_effectiveness, "  ", " "),
theme = from_nlo_to_foas(theme)) %>%
#get the improvements
left_join(mapping_foas,
by = c("foa_nlo1_effectiveness", "theme")
) %>%
#get the outcomes
left_join(lkp_outcomes) %>%
select(-int_outcome_nlo) %>%
#identifit those countries that have achieved it
mutate(achieved = ifelse(is.na(period)|period == "N/A", 0,1),
period = fct_recode(period, "< 2000" = "> 2000"))
tabyl(my_theme, foa)
#names(mapping_foas)
#Mapping of foas
mapping_foas <- import('data/1.reference/mapping_foas.xlsx') %>%
#updating the name of the foa
select(theme,
foa,
foa_nlo1_effectiveness,
improvement) %>%
filter(!is.na(foa)) %>%
group_by(theme,foa) %>%
slice(1) %>%
ungroup()
lkp_outcomes <- import('data/9.lookups/int_outcomes.xlsx')
#define section
sections <- c(#"relevance")
"effectiveness")
#define themes ---------------------------------------------------------------
themes <- names(raw_data)[str_detect(names(raw_data), 'theme')]
append_themes <- lapply(themes, function(t){
#get the suffix, it allows to identify the theme of the variables
sufix = get_suffix(t, raw_data)
r <- raw_data %>%
#keep data for relevance section only,
#and pivot it longer
#function created in functions.
keep_section(t, sections[1], sufix) %>%
#   #the column name contains all the info:
mutate(section = str_extract(name, '^.*?(?=-|_)'),
foa = str_remove(name, '^.*_[a-z]{1,}_'),
int_outcome_nlo = str_extract(foa, "_.{1,}$"),
foa = str_remove(foa, int_outcome_nlo),
int_outcome_nlo = str_remove(int_outcome_nlo, "_"),
int_outcome_nlo = str_trim(int_outcome_nlo),
int_outcome_nlo = ifelse(str_detect(int_outcome_nlo, "Upgrade institutions"), "Upgraded institutions / Laboratories/ Educational centers", int_outcome_nlo)
) %>%
rename(period = value,
foa_nlo1_effectiveness = foa) %>%
select(-name)
}) %>% do.call(rbind,.)
#clean relevance ---------------------------------------------------------------
periods <- sort(unique(append_themes$period))
tabyl(clean_effectiveness, theme)
#14,725
clean_effectiveness <- append_themes %>%
mutate(period = factor(period,
labels = periods,
ordered = T)) %>%
mutate(foa_nlo1_effectiveness = str_trim(foa_nlo1_effectiveness),
foa_nlo1_effectiveness = str_replace_all(foa_nlo1_effectiveness, "  ", " "),
theme = from_nlo_to_foas(theme)) %>%
#get the improvements
left_join(mapping_foas,
by = c("foa_nlo1_effectiveness", "theme")
) %>%
#get the outcomes
left_join(lkp_outcomes) %>%
select(-int_outcome_nlo) %>%
#identifit those countries that have achieved it
mutate(achieved = ifelse(is.na(period)|period == "N/A", 0,1),
period = fct_recode(period, "< 2000" = "> 2000"))
my_theme = filter(clean_effectiveness, theme == "Health and Nutrition")
tabyl(my_theme, foa)
#export ------------------------------------------------------------------------
export(clean_effectiveness, glue('data/7.NLO/2.raw_formatted/Part_1_{sections[1]}.rds'))
library(rio)
library(ggplot2)
library(RColorBrewer)
library(extrafont)
library(janitor)
#this data is cleaned in R/8.nlo/PartI/0.format
effectiveness <- import('data/7.NLO/2.raw_formatted/Part_1_effectiveness.rds')
names(effectiveness)
tabyl(effectiveness, foa, theme)
nrow(effectiveness)
tabyl(effectiveness, foa)
glue('{missing} of the questions were missing')
names(effectiveness)
powerbi_eff <- effectiveness %>%
#drop missing foas (we need to associate the missing ones in the mapping_foas)
filter(!is.na(foa)) %>%
group_by(country,region, theme,improvement, foa,int_outcome, foa_nlo1_effectiveness) %>%
summarise(when_int_outcome = min(period, na.rm = T),
achieved_int_outcome = max(achieved),
.groups = 'drop'
)
warnings()
tabyl(powerbi_sus, foa)
nrow(powerbi_eff)
sections
export(powerbi, glue('data/11.powerbi/{sections}.csv'))
export(powerbi_eff, glue('data/11.powerbi/{sections}.csv'))
names(powerbi_eff)
tabyl(clean_effectiveness, theme)
my_theme = filter(clean_effectiveness, theme == "Energy")
tabyl(my_theme, foa_nlo1_effectiveness)
raw_data <- import('data/7.NLO/1.raw/Part_1.rds')
#names(mapping_foas)
#Mapping of foas
mapping_foas <- import('data/1.reference/mapping_foas.xlsx') %>%
#updating the name of the foa
select(theme,
foa,
foa_nlo1_effectiveness,
improvement) %>%
filter(!is.na(foa)) %>%
group_by(theme,foa) %>%
slice(1) %>%
ungroup()
lkp_outcomes <- import('data/9.lookups/int_outcomes.xlsx')
#define section
sections <- c(#"relevance")
"effectiveness")
#define themes ---------------------------------------------------------------
themes <- names(raw_data)[str_detect(names(raw_data), 'theme')]
append_themes <- lapply(themes, function(t){
#get the suffix, it allows to identify the theme of the variables
sufix = get_suffix(t, raw_data)
r <- raw_data %>%
#keep data for relevance section only,
#and pivot it longer
#function created in functions.
keep_section(t, sections[1], sufix) %>%
#   #the column name contains all the info:
mutate(section = str_extract(name, '^.*?(?=-|_)'),
foa = str_remove(name, '^.*_[a-z]{1,}_'),
int_outcome_nlo = str_extract(foa, "_.{1,}$"),
foa = str_remove(foa, int_outcome_nlo),
int_outcome_nlo = str_remove(int_outcome_nlo, "_"),
int_outcome_nlo = str_trim(int_outcome_nlo),
int_outcome_nlo = ifelse(str_detect(int_outcome_nlo, "Upgrade institutions"), "Upgraded institutions / Laboratories/ Educational centers", int_outcome_nlo)
) %>%
rename(period = value,
foa_nlo1_effectiveness = foa) %>%
select(-name)
}) %>% do.call(rbind,.)
#clean relevance ---------------------------------------------------------------
periods <- sort(unique(append_themes$period))
tabyl(clean_effectiveness, theme)
#14,725
clean_effectiveness <- append_themes %>%
mutate(period = factor(period,
labels = periods,
ordered = T)) %>%
mutate(foa_nlo1_effectiveness = str_trim(foa_nlo1_effectiveness),
foa_nlo1_effectiveness = str_replace_all(foa_nlo1_effectiveness, "  ", " "),
theme = from_nlo_to_foas(theme)) %>%
#get the improvements
left_join(mapping_foas,
by = c("foa_nlo1_effectiveness", "theme")
) %>%
#get the outcomes
left_join(lkp_outcomes) %>%
select(-int_outcome_nlo) %>%
#identifit those countries that have achieved it
mutate(achieved = ifelse(is.na(period)|period == "N/A", 0,1),
period = fct_recode(period, "< 2000" = "> 2000"))
tabyl(clean_effectiveness, theme)
my_theme = filter(clean_effectiveness, theme == "Energy")
tabyl(my_theme, foa_nlo1_effectiveness)
tabyl(my_theme, foa)
#export ------------------------------------------------------------------------
export(clean_effectiveness, glue('data/7.NLO/2.raw_formatted/Part_1_{sections[1]}.rds'))
library(rio)
library(ggplot2)
library(RColorBrewer)
library(extrafont)
library(janitor)
#this data is cleaned in R/8.nlo/PartI/0.format
effectiveness <- import('data/7.NLO/2.raw_formatted/Part_1_effectiveness.rds')
#missing <- scales::percent(sum(is.na(effectiveness$period)) / nrow(effectiveness))
names(effectiveness)
tabyl(effectiveness, foa, theme)
nrow(effectiveness)
tabyl(effectiveness, foa)
glue('{missing} of the questions were missing')
names(effectiveness)
#data for power BI =============================================================
powerbi_eff <- effectiveness %>%
#drop missing foas (we need to associate the missing ones in the mapping_foas)
filter(!is.na(foa)) %>%
group_by(country,region, theme,improvement, foa,int_outcome, foa_nlo1_effectiveness) %>%
summarise(when_int_outcome = min(period, na.rm = T),
achieved_int_outcome = max(achieved),
.groups = 'drop'
)
names(powerbi_eff)
warnings()
tabyl(powerbi_sus, foa)
nrow(powerbi_eff)
sections
#View(powerbi)
export(powerbi_eff, glue('data/11.powerbi/{sections}.csv'))
tabyl(clean_effectiveness, theme)
my_theme = filter(clean_effectiveness, theme == "Industrial Applications/Radiation technology")
tabyl(my_theme, foa)
tabyl(my_theme, foa_nlo1_effectiveness)
library(rio)
library(dplyr)
library(tidyr)
library(janitor)
library(stringr)
library(forcats)
gmdacr::load_functions('functions/')
#import raw data creted in 0.format/format_names_part_1.R
#the above script formats the data from SPSS to R so it is readable
names(raw_data)
raw_data <- import('data/7.NLO/1.raw/Part_1.rds')
#names(mapping_foas)
#Mapping of foas
mapping_foas <- import('data/1.reference/mapping_foas.xlsx') %>%
#updating the name of the foa
select(theme,
foa,
foa_nlo1_effectiveness,
improvement) %>%
filter(!is.na(foa)) %>%
group_by(theme,foa) %>%
slice(1) %>%
ungroup()
#mapping_foas$foa[mapping_foas$theme == 'Health and Nutrition']
#lookup outcomes (to be consistent with ToC)
lkp_outcomes <- import('data/9.lookups/int_outcomes.xlsx')
#define section
sections <- c(#"relevance")
"effectiveness")
# "sustainability")
#"regionalCoop",
#"future",
#"visibility")
#define themes ---------------------------------------------------------------
themes <- names(raw_data)[str_detect(names(raw_data), 'theme')]
#each team enabled a different section of the questionnaire.
#bring all themes in a tidy format
#the name of the variable (created in 0.format/format_names_part_1.R) contains all the information
append_themes <- lapply(themes, function(t){
#get the suffix, it allows to identify the theme of the variables
sufix = get_suffix(t, raw_data)
r <- raw_data %>%
#keep data for relevance section only,
#and pivot it longer
#function created in functions.
keep_section(t, sections[1], sufix) %>%
#   #the column name contains all the info:
mutate(section = str_extract(name, '^.*?(?=-|_)'),
foa = str_remove(name, '^.*_[a-z]{1,}_'),
int_outcome_nlo = str_extract(foa, "_.{1,}$"),
foa = str_remove(foa, int_outcome_nlo),
int_outcome_nlo = str_remove(int_outcome_nlo, "_"),
int_outcome_nlo = str_trim(int_outcome_nlo),
int_outcome_nlo = ifelse(str_detect(int_outcome_nlo, "Upgrade institutions"), "Upgraded institutions / Laboratories/ Educational centers", int_outcome_nlo)
) %>%
rename(period = value,
foa_nlo1_effectiveness = foa) %>%
select(-name)
}) %>% do.call(rbind,.)
#clean relevance ---------------------------------------------------------------
periods <- sort(unique(append_themes$period))
tabyl(clean_effectiveness, theme)
#14,725
clean_effectiveness <- append_themes %>%
mutate(period = factor(period,
labels = periods,
ordered = T)) %>%
mutate(foa_nlo1_effectiveness = str_trim(foa_nlo1_effectiveness),
foa_nlo1_effectiveness = str_replace_all(foa_nlo1_effectiveness, "  ", " "),
theme = from_nlo_to_foas(theme)) %>%
#get the improvements
left_join(mapping_foas,
by = c("foa_nlo1_effectiveness", "theme")
) %>%
#get the outcomes
left_join(lkp_outcomes) %>%
select(-int_outcome_nlo) %>%
#identifit those countries that have achieved it
mutate(achieved = ifelse(is.na(period)|period == "N/A", 0,1),
period = fct_recode(period, "< 2000" = "> 2000"))
tabyl(clean_effectiveness, theme)
my_theme = filter(clean_effectiveness, theme == "Industrial Applications/Radiation technology")
tabyl(my_theme, foa_nlo1_effectiveness)
tabyl(my_theme, foa)
#export ------------------------------------------------------------------------
export(clean_effectiveness, glue('data/7.NLO/2.raw_formatted/Part_1_{sections[1]}.rds'))
library(rio)
library(ggplot2)
library(RColorBrewer)
library(extrafont)
library(janitor)
#this data is cleaned in R/8.nlo/PartI/0.format
effectiveness <- import('data/7.NLO/2.raw_formatted/Part_1_effectiveness.rds')
#missing <- scales::percent(sum(is.na(effectiveness$period)) / nrow(effectiveness))
names(effectiveness)
tabyl(effectiveness, foa, theme)
nrow(effectiveness)
tabyl(effectiveness, foa)
glue('{missing} of the questions were missing')
names(effectiveness)
#data for power BI =============================================================
powerbi_eff <- effectiveness %>%
#drop missing foas (we need to associate the missing ones in the mapping_foas)
filter(!is.na(foa)) %>%
group_by(country,region, theme,improvement, foa,int_outcome, foa_nlo1_effectiveness) %>%
summarise(when_int_outcome = min(period, na.rm = T),
achieved_int_outcome = max(achieved),
.groups = 'drop'
)
names(powerbi_eff)
warnings()
tabyl(powerbi_sus, foa)
nrow(powerbi_eff)
sections
#View(powerbi)
export(powerbi_eff, glue('data/11.powerbi/{sections}.csv'))
