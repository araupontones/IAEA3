})
}
raw_sections <- raw_multiple %>%
format_sections("q0005")
names(raw_sections)
format_sections <- function(.data, section, prefix){
.data %>%
rename_at(vars(starts_with(section)), function(x){
sapply(x, function(x){
label = attributes(raw_data[[x]])$label
no_commas = str_remove_all(label, ",|\\.")
snake = str_replace_all(no_commas, '""|-', "_")
paste(prefix, snake, sep = "_")
})
# print(x)
# print(at)
# snake = str_replace_all(no_commas, '""|-', "_")
# paste0("relevance_",str_replace_all(snake, " ", "_"))
})
}
raw_sections <- raw_multiple %>%
format_sections("q0005", "relevance")
names(raw_sections)
View(raw_sections)
raw_sections <- raw_multiple %>%
#relevance
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness")
names(raw_sections)
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability")
names(raw_sections)
attributes(raw_sections$`sustainability_Agricultural soil water and crop nutrition management _ Adoption of Plans/Policies/Programmes or Technical Standards by National/Regional Entities`)
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
mutate(across(starts_with('sustainability'),function(x)susor_get_stata_labels()))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
mutate(across(starts_with('sustainability'),function(x)susor_get_stata_labels(x)))
head(raw_sections$`sustainability_Agricultural soil water and crop nutrition management _ Adoption of Plans/Policies/Programmes or Technical Standards by National/Regional Entities`)
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
mutate(across(starts_with('sustainability|effectiveness'),function(x)susor_get_stata_labels(x)))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('q0008'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
names(raw_sections)[str_detect(names(raw_sections), "q0008")]
check <- names(raw_sections)[str_detect(names(raw_sections), "q0008")]
sapply(check, function(x){
print(x)
})
sapply(check, function(x){
print(x)
})
sapply(check, function(x){
print(x)
message(attributes(raw_sections[[x]]$label))
})
sapply(check, function(x){
print(x)
message(attributes(raw_sections[[x]])$label)
})
attributes(raw_sections[['q0008_0004_0008']])
attributes(raw_sections[['q0008_0004_0008']])$label
sapply(check, function(x){
print(x)
attributes(raw_sections[[x]])$label
})
sapply(check, function(x){
print(x)
print(attributes(raw_sections[[x]]))
message(attributes(raw_sections[[x]])$label)
})
format_sections <- function(.data, section, prefix){
.data %>%
rename_at(vars(starts_with(section)), function(x){
#use the label as the name of the variable
sapply(x, function(x){
label = attributes(raw_data[[x]])$label
no_commas = str_remove_all(label, ",|\\.")
snake = str_replace_all(no_commas, '""|-', "_")
#add prefix to identify section
new_name <- paste(prefix, snake, sep = "_")
if(section == "regional_coop"){
new_name = paste(new_name, attributes(raw_data[[x]])$labels)
}
new_name
})
})
}
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
format_sections <- function(.data, section, prefix){
.data %>%
rename_at(vars(starts_with(section)), function(x){
#use the label as the name of the variable
sapply(x, function(x){
label = attributes(raw_data[[x]])$label
no_commas = str_remove_all(label, ",|\\.")
snake = str_replace_all(no_commas, '""|-', "_")
#add prefix to identify section
new_name <- paste(prefix, snake, sep = "_")
if(prefix == "regional_coop"){
new_name = paste(new_name, attributes(raw_data[[x]])$labels)
}
new_name
})
})
}
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
sapply(check, function(x){
print(x)
print(attributes(raw_sections[[x]]))
message(attributes(raw_sections[[x]])$label)
})
format_sections <- function(.data, section, prefix){
.data %>%
rename_at(vars(starts_with(section)), function(x){
#use the label as the name of the variable
sapply(x, function(x){
label = attributes(raw_data[[x]])$label
no_commas = str_remove_all(label, ",|\\.")
snake = str_replace_all(no_commas, '""|-', "_")
#add prefix to identify section
new_name <- paste(prefix, snake, sep = "_")
if(prefix == "regional_coop"){
new_name = paste(new_name, names(attributes(raw_data[[x]])$labels))
}
new_name
})
})
}
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
names(raw_sections)
format_sections <- function(.data, section, prefix){
.data %>%
rename_at(vars(starts_with(section)), function(x){
#use the label as the name of the variable
sapply(x, function(x){
label = attributes(raw_data[[x]])$label
no_commas = str_remove_all(label, ",|\\.")
snake = str_replace_all(no_commas, '""|-', "_")
#add prefix to identify section
new_name <- paste(prefix, snake, sep = "_")
if(prefix == "regional_coop"){
new_name = paste(new_name, names(attributes(raw_data[[x]])$labels), sep = "___")
}
new_name
})
})
}
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
names(raw_sections)
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with("q0009"))
check <- names(raw_sections)[str_detect(names(raw_sections), "q0009")]
sapply(check, function(x){
print(x)
print(attributes(raw_sections[[x]]))
message(attributes(raw_sections[[x]])$label)
})
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with("q0009"))
names(raw_sections)
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'))
,function(x)susor_get_stata_labels(x)))
names(raw_sections)
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x)))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('effectiveness'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('sustinability'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('sustainability'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('relevance'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('relevance'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('effectiveness'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('regional_coop'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('regional_coop'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('regional_coop'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('regional_coop'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
format_sections('q0010', "visibility") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('regional_coop'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
format_sections('q0010', "visibility") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('visibility'))
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
format_sections('q0010', "visibility") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'),
starts_with('visibility'))
,function(x)susor_get_stata_labels(x))) %>%
select(starts_with('visibility'))
check <- names(raw_sections)[str_detect(names(raw_sections), "q0011")]
sapply(check, function(x){
print(x)
print(attributes(raw_sections[[x]]))
message(attributes(raw_sections[[x]])$label)
})
names(raw_sections)
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
format_sections('q0010', "visibility") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'),
starts_with('visibility'))
,function(x)susor_get_stata_labels(x)))
names(raw_sections)
check <- names(raw_sections)[str_detect(names(raw_sections), "q0011")]
sapply(check, function(x){
print(x)
print(attributes(raw_sections[[x]]))
message(attributes(raw_sections[[x]])$label)
})
raw_sections <- raw_multiple %>%
#FOOD AND AGRICULTURE
format_sections("q0005", "relevance") %>%
format_sections("q0006", "effectiveness") %>%
format_sections('q0007', "sustainability") %>%
format_sections('q0008', "regional_coop") %>%
format_sections('q0009', "future") %>%
format_sections('q0010', "visibility") %>%
#HEALTH AND NUTRITION
format_sections("q0011", "relevance") %>%
format_sections("q0012", "effectiveness") %>%
format_sections('q0013', "sustainability") %>%
format_sections('q0014', "regional_coop") %>%
format_sections('q0015', "future") %>%
format_sections('q0016', "visibility") %>%
mutate(across(c(
starts_with('relevance'),
starts_with('sustainability'),
starts_with('effectiveness'),
starts_with('future'),
starts_with('visibility'))
,function(x)susor_get_stata_labels(x)))
names(raw_sections)
library("haven")
library("gmdacr")
