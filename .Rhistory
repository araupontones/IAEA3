#facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom')
ggplot(data_plot,
aes(
y = improvement,
x = total,
fill = period)) +
geom_col(position = position_dodge2()) +
labs(y = "") +
scale_y_discrete(labels = label_wrap(10)) +
#facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom')
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile()
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(10))
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(10)) +
scale_fill_distiller(palette = "Blues", direction = 1)
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(10)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
#facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom')
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(10)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom')
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(12)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom')
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(15)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom')
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(20)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom')
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom')
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "") +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank())
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "") +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank())
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Effectiveness",
subtitle = "Time range when improvements where introduce by TCP."
) +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank())
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Effectiveness",
subtitle = "Time range when improvements where introduce by TCP."
) +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
ggsave('plots/effectiveness_test.png',
last_plot())
glue('{missing} of the questions were missing')
completed
#define section
sections <- c(#"relevance")
#"effectiveness")
"sustainability")
#define section
sections <- c(#"relevance")
#"effectiveness")
"sustainability")
raw_data <- import('data/7.NLO/1.raw/Part_1.rds')
#define section
sections <- c(#"relevance")
#"effectiveness")
"sustainability")
#define section
sections <- c(#"relevance")
#"effectiveness")
"sustainability")
#define themes ---------------------------------------------------------------
themes <- names(raw_data)[str_detect(names(raw_data), 'theme')]
append_themes <- lapply(themes, function(t){
#get the suffix, it allows to identify the theme of the variables
sufix = get_suffix(t, raw_data)
r <- raw_data %>%
#keep data for relevance section only,
#and pivot it longer
#function created in functions.
keep_section(t, sections[1], sufix) %>%
#   #the column name contains all the info:
mutate(section = str_extract(name, '^.*?(?=-|_)'),
foa = str_remove(name, '^.*_[a-z]{1,}_'),
improvement = str_extract(foa, "_.{1,}$"),
foa = str_remove(foa, improvement),
improvement = str_remove(improvement, "_")
) %>%
rename(period = value) %>%
select(-name)
}) %>% do.call(rbind,.)
View(append_themes)
#clean relevance ---------------------------------------------------------------
periods <- sort(unique(append_themes$period))
clean_sustainability <- append_themes %>%
mutate(period = factor(period,
labels = periods,
ordered = T))
#export ------------------------------------------------------------------------
export(clean_sustainability, 'data/7.NLO/2.raw_formatted/Part_1_sustainability.rds')
sustainability <- import('data/7.NLO/2.raw_formatted/Part_1_sustainability.rds')
missing <- scales::percent(sum(is.na(sustainability$period)) / nrow(sustainability))
glue('{missing} of the questions were missing')
names(sustainability)
qa <- sustainability %>%
group_by(id) %>%
summarise(questions = n(),
unanswered = sum(is.na(period)),
perc_unanswered = unanswered/questions
)
completed <- sum(qa$perc_unanswered == 0)
completed
data_plot <- sustainability %>%
filter(theme == "FOOD and AGRICULTURE") %>%
filter(!is.na(period),
period != "N/A") %>%
group_by(theme, improvement, period, region) %>%
summarise(total = n())
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "sustainability",
subtitle = "Time range when improvements where introduce by TCP."
) +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(35)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(50)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(40)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0, size = 10),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0, size = 8),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(30)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0, size = 7),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(35)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0, size = 7),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
#plot
ggplot(data_plot,
aes(
y = improvement,
x = period,
fill = total)) +
geom_tile() +
labs(y = "",
x = "",
title = "Sustainability",
subtitle = "Estimated period when the improvements introduced by TCP produced tangible results."
) +
scale_y_discrete(labels = label_wrap(35)) +
scale_fill_distiller(palette = "Blues", direction = 1) +
facet_wrap(~region) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90),
axis.text.y = element_text(hjust = 0, size = 8),
legend.position = 'bottom',
legend.title = element_blank(),
plot.title.position = 'plot',
text = element_text(family = "Open Sans"))
ggsave('plots/sustainability_test.png',
last_plot())
glue('{missing} of the questions were missing')
completed
